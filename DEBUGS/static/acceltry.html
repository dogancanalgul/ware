<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>GeoAR.js demo</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
  </head>
  <script>

    function httpGet(text) {
      var xmlHttp = new XMLHttpRequest();
      //console.log(text);

      xmlHttp.open( "GET", "https://192.168.1.241:8083/read", false ); // false for synchronous request
      xmlHttp.setRequestHeader('msg', text);
      xmlHttp.send();
      return xmlHttp.responseText;
    }

    AFRAME.registerComponent("movement", {
      schema: {
        acceleration: {type:'vec3', default:'0 0 0'}
      },


      init: function(){
         let tempAcc = this
         function handleMotion(event){
            tempAcc.acceleration.x = tempAcc.acceleration.x
            tempAcc.acceleration.y = event.acceleration.y
            tempAcc.acceleration.z = event.acceleration.z
            //httpGet(tempAcc.acceleration.x + " " + tempAcc.acceleration.y + " "  + tempAcc.acceleration.z + " handler ");
          if(event.acceleration.x > 1){
            tempAcc.el.object3D.scale.x = 1;
            tempAcc.el.object3D.scale.y = 1;
            tempAcc.el.object3D.scale.z = 1;
          }
          else if(event.acceleration.x < -1){
            tempAcc.el.object3D.scale.x = 3;
            tempAcc.el.object3D.scale.y = 3;
            tempAcc.el.object3D.scale.z = 3;
          }
        };
        httpGet("init")
          window.addEventListener("devicemotion", handleMotion, true);
          this.acceleration = {x: 0, y: 0, z: 0}
          this.frameCount = 0;
      },
      tick: function(time, timeDelta){
        this.frameCount++;
        if(this.frameCount == 60){
          httpGet("tick: " + this.frameCount)
          //httpGet(JSON.stringify(this.el.getAttribute('gps-entity-place')))
          this.frameCount = 0;
        }
        if(this.frameCount % 20 == 0){
          httpGet(this.acceleration.x + " " + this.acceleration.y + " "  + this.acceleration.z + " m/s2 ");
        }
      },

    });
  </script>
  <body id='headque' style="margin: 0; overflow: hidden;">
    <a-scene
      id='finally'
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
    <!--
      <a-text
        id="globalOne"
        value="This content will always face you."
        look-at="[gps-camera]"
        scale="120 120 120"

      ></a-text>
      <a-box movement id="globalOne" color="#FFFFFF" scale="2 2 2"  gps-entity-place="latitude: 0; longitude: ;" >
        -->
      <a-box movement id="globalOne" color="#FFFFFF" position = "0 0 0" scale="4 4 4" >
      </a-box>
      <a-camera gps-camera rotation-reader> </a-camera>
    </a-scene>
  </body>
  <script>

    httpGet("Running...")
    this.atext = document.getElementById("globalOne");
    httpGet("This is fine")
    httpGet(this.atext)
    function getLocation() {
      httpGet("Navigator:")
      if(navigator.accelerometer)
          httpGet("It has")
      else
        httpGet("It doesnt")

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(putPosition);
      } else {
        httpGet("Geolocation is not supported by this browser.");
      }
    }
    function putPosition(position) {
        httpGet("Putting it: ")
        //this.atext.setAttribute('gps-entity-place') = position.coords.latitude;
        this.atext.setAttribute('gps-entity-place', 'latitude: ' + position.coords.latitude + '; longitude: ' +  position.coords.longitude + ';')
        httpGet("Putting it2: ")
        httpGet(this.atext.getAttribute('gps-entity-place'))
    }
    getLocation()
    </script>
</html>